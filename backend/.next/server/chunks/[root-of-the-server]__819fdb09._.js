module.exports=[93695,(e,t,r)=>{t.exports=e.x("next/dist/shared/lib/no-fallback-error.external.js",()=>require("next/dist/shared/lib/no-fallback-error.external.js"))},32319,(e,t,r)=>{t.exports=e.x("next/dist/server/app-render/work-unit-async-storage.external.js",()=>require("next/dist/server/app-render/work-unit-async-storage.external.js"))},24725,(e,t,r)=>{t.exports=e.x("next/dist/server/app-render/after-task-async-storage.external.js",()=>require("next/dist/server/app-render/after-task-async-storage.external.js"))},18622,(e,t,r)=>{t.exports=e.x("next/dist/compiled/next-server/app-page-turbo.runtime.prod.js",()=>require("next/dist/compiled/next-server/app-page-turbo.runtime.prod.js"))},56704,(e,t,r)=>{t.exports=e.x("next/dist/server/app-render/work-async-storage.external.js",()=>require("next/dist/server/app-render/work-async-storage.external.js"))},70406,(e,t,r)=>{t.exports=e.x("next/dist/compiled/@opentelemetry/api",()=>require("next/dist/compiled/@opentelemetry/api"))},29173,(e,t,r)=>{t.exports=e.x("@prisma/client",()=>require("@prisma/client"))},97288,e=>{"use strict";var t=e.i(29173);let r=globalThis,o=r.prisma??new t.PrismaClient;r.prisma=o,e.s(["default",0,o,"prisma",0,o])},68589,e=>{"use strict";var t=e.i(9091),r=e.i(62092),o=e.i(17178),n=e.i(43115),i=e.i(18530),a=e.i(31836),l=e.i(72198),s=e.i(7482),d=e.i(94539),u=e.i(25429),p=e.i(82365),c=e.i(12250),f=e.i(10656),h=e.i(22435),x=e.i(10688),C=e.i(70503),g=e.i(93695);e.i(52384);var m=e.i(63907),S=e.i(52115),R=e.i(97288);async function E(t,{params:r}){try{let{id:t}=await r,o=await R.prisma.booking.findUnique({where:{id:t},include:{flight:!0,user:{select:{name:!0,email:!0,membershipLevel:!0}}}});if(!o)return S.NextResponse.json({message:"找不到預訂記錄"},{status:404});if(!o.checkedIn)return S.NextResponse.json({message:"請先完成值機"},{status:400});let n=new(await e.A(81425)).default({size:"A4",margin:50,bufferPages:!0}),i=[];n.on("datat(",e=>{i.push(e)});let a=e=>{let t=String(e.getHours()).padStart(2,"0"),r=String(e.getMinutes()).padStart(2,"0");return`${t}:${r}`},l=new Promise((e,t)=>{n.on("end",()=>{try{let t=Buffer.concat(i);e(t)}catch(e){t(e)}}),n.on("error",e=>{t(e)});try{let e,t,r;n.rect(0,0,595,100).fill("#FDB913"),n.fontSize(28).fillColor("#000000").text("YELLOW AIRLINES",50,30,{align:"center"}),n.fontSize(14).fillColor("#000000").text("登機牌 BOARDING PASS",50,65,{align:"center"}),n.rect(50,120,495,350).fillAndStroke("#FFFFFF","#CCCCCC"),n.fontSize(10).fillColor("#666666").text("PASSENGER NAME 乘客姓名",70,140),n.fontSize(18).fillColor("#000000").text(o.passengerName.toUpperCase(),70,160);let i=new Date(o.flight.departureTime);o.flight.arrivalTime,n.fontSize(10).fillColor("#666666").text("FROM 從",70,200),n.fontSize(32).fillColor("#FDB913").text(o.flight.from,70,220),n.fontSize(12).fillColor("#000000").text(o.flight.fromCity,70,260),n.fontSize(24).fillColor("#666666").text("→",230,230),n.fontSize(12).fillColor("#666666").text("FLIGHT 航班",210,265),n.fontSize(14).fillColor("#000000").text(o.flight.flightNumber,210,280),n.fontSize(10).fillColor("#666666").text("TO 到",350,200),n.fontSize(32).fillColor("#FDB913").text(o.flight.to,350,220),n.fontSize(12).fillColor("#000000").text(o.flight.toCity,350,260),n.fontSize(10).fillColor("#666666").text("DATE 日期",70,320),n.fontSize(14).fillColor("#000000").text((e=String(i.getDate()).padStart(2,"0"),t=[")JAN","FEB","MAR","APR","MAY","JUN","JUL","AUG","SEP","OCT","NOV","DEC"][i.getMonth()],r=i.getFullYear(),`${e} ${t} ${r}`),70,340);let l=new Date(i.getTime()-18e5);n.fontSize(10).fillColor("#666666").text("BOARDING 登機",200,320),n.fontSize(14).fillColor("#000000").text(a(l),200,340),n.fontSize(10).fillColor("#666666").text("DEPARTURE 起飛",290,320),n.fontSize(14).fillColor("#000000").text(a(i),290,340),n.fontSize(10).fillColor("#666666").text("SEAT 座位",390,320),n.fontSize(24).fillColor("#FDB913").text(o.seatNumber||"N/A",390,330);let s="ECONOMY";"PREMIUM_ECONOMY"===o.cabinClass&&(s="PREMIUM"),"BUSINESS"===o.cabinClass&&(s="BUSINESS"),"FIRST_CLASS"===o.cabinClass&&(s="FIRST"),n.fontSize(10).fillColor("#666666").text("CLASS 艙位",470,320),n.fontSize(12).fillColor("#000000").text(s,470,340),n.fontSize(10).fillColor("#666666").text("BOOKING REF 預訂編號",70,390),n.fontSize(16).fillColor("#000000").text(o.bookingNumber,70,410),o.user?.membershipLevel&&(n.fontSize(10).fillColor("#666666").text("MEMBER 會員",280,390),n.fontSize(14).fillColor("#FDB913").text(o.user.membershipLevel,280,410));let d=`${String.fromCharCode(65+Math.floor(10*Math.random()))}${Math.floor(50*Math.random())+1}`,u=Math.floor(5*Math.random())+1;n.fontSize(10).fillColor("#666666").text("GATE 登機口",420,390),n.fontSize(16).fillColor("#000000").text(d,420,410),n.fontSize(10).fillColor("#666666").text(`GROUP ${u}`,420,435),n.moveTo(50,480).lineTo(545,480).strokeColor("#DDDDDD").lineWidth(1).stroke(),n.fontSize(10).fillColor("#666666").text("PLEASE PRESENT THIS BOARDING PASS 請出示此登機牌",50,500,{align:"center",width:495});let p=120,c=`${o.bookingNumber}${o.flight.flightNumber}${o.seatNumber||""}`;for(let e=0;e<c.length&&p<480;e++){let t=c.charCodeAt(e),r=t%2==0?60:40,o=t%3==0?3:2;e%2==0&&n.rect(p,530,o,r).fill("#000000"),p+=o+1}n.fontSize(10).fillColor("#000000").text(o.bookingNumber,50,600,{align:"center",width:495}),n.fontSize(8).fillColor("#CC0000").text("⚠ 請提前90分鐘到達機場 | Please arrive 90 minutes before departure",50,640,{align:"center",width:495}),n.rect(490,620,50,50).stroke("#000000");for(let e=0;e<8;e++)for(let t=0;t<8;t++)(o.bookingNumber.charCodeAt(e%o.bookingNumber.length)+e*t)%3!=0&&n.rect(495+5*t,625+5*e,4,4).fill("#000000");n.fontSize(8).fillColor("#999999").text("Yellow Airlines - Your Journey, Our Passion",50,720,{align:"center",width:495}),n.end()}catch(e){t(e)}}),s=await l;return new S.NextResponse(s,{status:200,headers:{"Content-Type":"application/pdf","Content-Disposition":`attachment; filename="boarding-pass-${o.bookingNumber}.pdf"`,"Content-Length":s.length.toString()}})}catch(e){return console.error("生成登機牌錯誤:",e),S.NextResponse.json({message:"生成登機牌時發生錯誤",error:String(e)},{status:500})}}e.s(["GET",()=>E],16106);var v=e.i(16106);let b=new t.AppRouteRouteModule({definition:{kind:r.RouteKind.APP_ROUTE,page:"/api/boarding-pass/[id]/route",pathname:"/api/boarding-pass/[id]",filename:"route",bundlePath:""},distDir:".next",relativeProjectDir:"",resolvedPagePath:"[project]/Documents/Yellow Airlines/yellow-airlines/backend/app/api/boarding-pass/[id]/route.ts",nextConfigOutput:"",userland:v}),{workAsyncStorage:w,workUnitAsyncStorage:A,serverHooks:N}=b;function y(){return(0,o.patchFetch)({workAsyncStorage:w,workUnitAsyncStorage:A})}async function T(e,t,o){b.isDev&&(0,n.addRequestMeta)(e,"devRequestTimingInternalsEnd",process.hrtime.bigint());let S="/api/boarding-pass/[id]/route";S=S.replace(/\/index$/,"")||"/";let R=await b.prepare(e,t,{srcPage:S,multiZoneDraftMode:!1});if(!R)return t.statusCode=400,t.end("Bad Request"),null==o.waitUntil||o.waitUntil.call(o,Promise.resolve()),null;let{buildId:E,params:v,nextConfig:w,parsedUrl:A,isDraftMode:N,prerenderManifest:y,routerServerContext:T,isOnDemandRevalidate:P,revalidateOnlyGenerated:O,resolvedPathname:k,clientReferenceManifest:z,serverActionsManifest:M}=R,D=(0,s.normalizeAppPath)(S),I=!!(y.dynamicRoutes[D]||y.routes[k]),U=async()=>((null==T?void 0:T.render404)?await T.render404(e,t,A,!1):t.end("This page could not be found"),null);if(I&&!N){let e=!!y.routes[k],t=y.dynamicRoutes[D];if(t&&!1===t.fallback&&!e){if(w.experimental.adapterPath)return await U();throw new g.NoFallbackError}}let _=null;!I||b.isDev||N||(_="/index"===(_=k)?"/":_);let F=!0===b.isDev||!I,j=I&&!F;M&&z&&(0,a.setReferenceManifestsSingleton)({page:S,clientReferenceManifest:z,serverActionsManifest:M,serverModuleMap:(0,l.createServerModuleMap)({serverActionsManifest:M})});let q=e.method||"GET",$=(0,i.getTracer)(),H=$.getActiveScopeSpan(),B={params:v,prerenderManifest:y,renderOpts:{experimental:{authInterrupts:!!w.experimental.authInterrupts},cacheComponents:!!w.cacheComponents,supportsDynamicResponse:F,incrementalCache:(0,n.getRequestMeta)(e,"incrementalCache"),cacheLifeProfiles:w.cacheLife,waitUntil:o.waitUntil,onClose:e=>{t.on("close",e)},onAfterTaskError:void 0,onInstrumentationRequestError:(t,r,o)=>b.onRequestError(e,t,o,T)},sharedContext:{buildId:E}},L=new d.NodeNextRequest(e),G=new d.NodeNextResponse(t),K=u.NextRequestAdapter.fromNodeNextRequest(L,(0,u.signalFromNodeResponse)(t));try{let a=async e=>b.handle(K,B).finally(()=>{if(!e)return;e.setAttributes({"http.status_code":t.statusCode,"next.rsc":!1});let r=$.getRootSpanAttributes();if(!r)return;if(r.get("next.span_type")!==p.BaseServerSpan.handleRequest)return void console.warn(`Unexpected root span type '${r.get("next.span_type")}'. Please report this Next.js issue https://github.com/vercel/next.js`);let o=r.get("next.route");if(o){let t=`${q} ${o}`;e.setAttributes({"next.route":o,"http.route":o,"next.span_name":t}),e.updateName(t)}else e.updateName(`${q} ${S}`)}),l=!!(0,n.getRequestMeta)(e,"minimalMode"),s=async n=>{var i,s;let d=async({previousCacheEntry:r})=>{try{if(!l&&P&&O&&!r)return t.statusCode=404,t.setHeader("x-nextjs-cache","REVALIDATED"),t.end("This page could not be found"),null;let i=await a(n);e.fetchMetrics=B.renderOpts.fetchMetrics;let s=B.renderOpts.pendingWaitUntil;s&&o.waitUntil&&(o.waitUntil(s),s=void 0);let d=B.renderOpts.collectedTags;if(!I)return await (0,f.sendResponse)(L,G,i,B.renderOpts.pendingWaitUntil),null;{let e=await i.blob(),t=(0,h.toNodeOutgoingHttpHeaders)(i.headers);d&&(t[C.NEXT_CACHE_TAGS_HEADER]=d),!t["content-type"]&&e.type&&(t["content-type"]=e.type);let r=void 0!==B.renderOpts.collectedRevalidate&&!(B.renderOpts.collectedRevalidate>=C.INFINITE_CACHE)&&B.renderOpts.collectedRevalidate,o=void 0===B.renderOpts.collectedExpire||B.renderOpts.collectedExpire>=C.INFINITE_CACHE?void 0:B.renderOpts.collectedExpire;return{value:{kind:m.CachedRouteKind.APP_ROUTE,status:i.status,body:Buffer.from(await e.arrayBuffer()),headers:t},cacheControl:{revalidate:r,expire:o}}}}catch(t){throw(null==r?void 0:r.isStale)&&await b.onRequestError(e,t,{routerKind:"App Router",routePath:S,routeType:"route",revalidateReason:(0,c.getRevalidateReason)({isStaticGeneration:j,isOnDemandRevalidate:P})},T),t}},u=await b.handleResponse({req:e,nextConfig:w,cacheKey:_,routeKind:r.RouteKind.APP_ROUTE,isFallback:!1,prerenderManifest:y,isRoutePPREnabled:!1,isOnDemandRevalidate:P,revalidateOnlyGenerated:O,responseGenerator:d,waitUntil:o.waitUntil,isMinimalMode:l});if(!I)return null;if((null==u||null==(i=u.value)?void 0:i.kind)!==m.CachedRouteKind.APP_ROUTE)throw Object.defineProperty(Error(`Invariant: app-route received invalid cache entry ${null==u||null==(s=u.value)?void 0:s.kind}`),"__NEXT_ERROR_CODE",{value:"E701",enumerable:!1,configurable:!0});l||t.setHeader("x-nextjs-cache",P?"REVALIDATED":u.isMiss?"MISS":u.isStale?"STALE":"HIT"),N&&t.setHeader("Cache-Control","private, no-cache, no-store, max-age=0, must-revalidate");let p=(0,h.fromNodeOutgoingHttpHeaders)(u.value.headers);return l&&I||p.delete(C.NEXT_CACHE_TAGS_HEADER),!u.cacheControl||t.getHeader("Cache-Control")||p.get("Cache-Control")||p.set("Cache-Control",(0,x.getCacheControlHeader)(u.cacheControl)),await (0,f.sendResponse)(L,G,new Response(u.value.body,{headers:p,status:u.value.status||200})),null};H?await s(H):await $.withPropagatedContext(e.headers,()=>$.trace(p.BaseServerSpan.handleRequest,{spanName:`${q} ${S}`,kind:i.SpanKind.SERVER,attributes:{"http.method":q,"http.target":e.url}},s))}catch(t){if(t instanceof g.NoFallbackError||await b.onRequestError(e,t,{routerKind:"App Router",routePath:D,routeType:"route",revalidateReason:(0,c.getRevalidateReason)({isStaticGeneration:j,isOnDemandRevalidate:P})}),I)throw t;return await (0,f.sendResponse)(L,G,new Response(null,{status:500})),null}}e.s(["handler",()=>T,"patchFetch",()=>y,"routeModule",()=>b,"serverHooks",()=>N,"workAsyncStorage",()=>w,"workUnitAsyncStorage",()=>A],68589)},81425,e=>{e.v(t=>Promise.all(["server/chunks/[root-of-the-server]__fd863a35._.js","server/chunks/63c6c_aa0cb324._.js"].map(t=>e.l(t))).then(()=>t(25193)))}];

//# sourceMappingURL=%5Broot-of-the-server%5D__819fdb09._.js.map