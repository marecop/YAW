module.exports=[93050,e=>{"use strict";var t=e.i(9091),a=e.i(62092),r=e.i(17178),i=e.i(43115),n=e.i(18530),l=e.i(31836),o=e.i(72198),s=e.i(7482),u=e.i(94539),d=e.i(25429),c=e.i(82365),h=e.i(12250),g=e.i(10656),p=e.i(22435),f=e.i(10688),m=e.i(70503),D=e.i(93695);e.i(52384);var w=e.i(63907),A=e.i(52115),R=e.i(97288);let T={"Yellow Airlines":"B","Cathay Pacific":"B","China Southern":"B",Emirates:"A6",Lufthansa:"D","British Airways":"G","Singapore Airlines":"9V",ANA:"JA","Japan Airlines":"JA","United Airlines":"N","American Airlines":"N","Delta Air Lines":"N","Air France":"F",Qantas:"VH",default:"XX"};function v(){let e=Math.random();return e>.95?"STORMY":e>.9?"SNOWY":e>.8?"FOGGY":e>.6?"RAINY":e>.3?"CLOUDY":"SUNNY"}async function E(e=new Date){let t=new Date(e);t.setHours(0,0,0,0),new Date(e).setHours(23,59,59,999),console.log(`ğŸ” æª¢æŸ¥ ${t.toISOString().split("T")[0]} çš„èˆªç­å¯¦ä¾‹...`);let a=await R.prisma.flight.findMany({select:{id:!0,operatingDays:!0,departureTime:!0,arrivalTime:!0,aircraft:!0,airline:!0,from:!0,to:!0,flightNumber:!0}}),r=t.getDay()||7,i=a.filter(e=>e.operatingDays.includes(r.toString()));console.log(`âœˆï¸ è¨ˆåŠƒèˆªç­æ•¸é‡: ${i.length}`);let n=await R.prisma.flightInstance.findMany({where:{date:t},select:{id:!0,flightId:!0,aircraftRegistration:!0}});console.log(`âœ… ä»Šæ—¥å·²å­˜åœ¨å¯¦ä¾‹: ${n.length} æ¢`);let l=new Set(n.map(e=>e.flightId)),o=i.filter(e=>!l.has(e.id));if(0===o.length)return void console.log("âœ¨ æ‰€æœ‰èˆªç­å¯¦ä¾‹å·²å°±ç·’");console.log(`âš¡ï¸ ç‚º ${o.length} å€‹æ–°èˆªç­å‰µå»ºå¯¦ä¾‹...`);let s=[];for(let e of o){let[a,r]=e.departureTime.split(":").map(Number),[i,n]=e.arrivalTime.split("+")[0].trim().split(":").map(Number);if(isNaN(a)||isNaN(r)||isNaN(i)||isNaN(n)){console.error(`Skipping flight ${e.flightNumber}: Invalid time format (Dep: ${e.departureTime}, Arr: ${e.arrivalTime})`);continue}let l=new Date(t);l.setHours(a,r,0,0);let o=new Date(t);if(o.setHours(i,n,0,0),e.arrivalTime.includes("+")){let t=e.arrivalTime.match(/\+(\d+)/),a=t?parseInt(t[1]):0;o.setDate(o.getDate()+a)}else o<l&&o.setDate(o.getDate()+1);let u=Math.floor(31*Math.random())-10,d=new Date(l.getTime()+6e4*u),c=Math.floor(31*Math.random())-20,h=o.getTime()-l.getTime(),g=new Date(d.getTime()+h+6e4*c);s.push({flightId:e.id,date:t,status:"SCHEDULED",scheduledDeparture:l,scheduledArrival:o,actualDeparture:d,actualArrival:g,aircraftType:e.aircraft,airline:e.airline,origin:e.from,destination:e.to,flightNumber:e.flightNumber,gate:`${String.fromCharCode(65+Math.floor(5*Math.random()))}${Math.floor(20*Math.random())+1}`,terminal:`T${Math.floor(2*Math.random())+1}`,weatherOrigin:v(),weatherDestination:v()})}s.sort((e,t)=>e.scheduledDeparture.getTime()-t.scheduledDeparture.getTime());let u=new Map,d=new Set;n.forEach(e=>{e.aircraftRegistration&&d.add(e.aircraftRegistration)});let c=new Map;for(let e=0;e<s.length;e++){let t=s[e];if(!(c.has(e.toString())||Array.from(c.values()).includes(e.toString())))for(let a=e+1;a<s.length;a++){let r=s[a];if(!Array.from(c.values()).includes(a.toString())&&t.airline===r.airline&&t.destination===r.origin&&t.origin===r.destination&&r.scheduledDeparture.getTime()>t.scheduledArrival.getTime()+36e5){c.set(e.toString(),a.toString());break}}}for(let e=0;e<s.length;e++){let t=s[e];if(t.aircraftRegistration)continue;let a=null,r=Array.from(u.entries()).find(([e,a])=>(!!a.airline.includes(t.airline)||!!t.airline.includes(a.airline))&&a.location===t.origin&&!(t.scheduledDeparture.getTime()-a.availableTime<54e5));a=r?r[0]:function(e,t){let a=function(e){for(let[t,a]of Object.entries(T))if(e.includes(t))return a;return"B"}(e),r="";do{let e=Math.floor(9e3*Math.random())+1e3;r=`${a}-${e}`}while(t.has(r))return t.add(r),r}(t.airline,d),t.aircraftRegistration=a;let i=c.get(e.toString());if(i){let e=s[parseInt(i)];e.scheduledDeparture.getTime()-t.scheduledArrival.getTime()>=54e5?(e.aircraftRegistration=a,u.set(a,{location:e.destination,availableTime:e.scheduledArrival.getTime(),airline:e.airline})):u.set(a,{location:t.destination,availableTime:t.scheduledArrival.getTime(),airline:t.airline})}else u.set(a,{location:t.destination,availableTime:t.scheduledArrival.getTime(),airline:t.airline})}console.log("ğŸ’¾ ä¿å­˜æ–°èˆªç­å¯¦ä¾‹åˆ°æ•¸æ“šåº«...");let h=s.map(e=>({flightId:e.flightId,date:e.date,status:e.status,scheduledDeparture:e.scheduledDeparture,scheduledArrival:e.scheduledArrival,actualDeparture:e.actualDeparture,actualArrival:e.actualArrival,aircraftRegistration:e.aircraftRegistration,aircraftType:e.aircraftType,gate:e.gate,terminal:e.terminal,weatherOrigin:e.weatherOrigin,weatherDestination:e.weatherDestination}));for(let e=0;e<h.length;e+=50){let t=h.slice(e,e+50);await R.prisma.flightInstance.createMany({data:t})}console.log("âœ… æ‰€æœ‰èˆªç­å¯¦ä¾‹åŒæ­¥å®Œæˆ")}async function N(e=new Date){let t=new Date(e);t.setHours(0,0,0,0);let a=new Date,r=await R.prisma.flightInstance.findMany({where:{date:t},select:{id:!0,status:!0,scheduledDeparture:!0,scheduledArrival:!0,actualDeparture:!0,actualArrival:!0,weatherOrigin:!0,weatherDestination:!0}});for(let e of(console.log(`ğŸ”„ æ›´æ–° ${r.length} å€‹èˆªç­çš„ç‹€æ…‹...`),r)){let t=e.status,r=e.actualDeparture,i=e.actualArrival;if(["ARRIVED","CANCELLED"].includes(t))continue;if("SCHEDULED"===t&&("STORMY"===e.weatherOrigin||"STORMY"===e.weatherDestination)&&.2>Math.random()){t="CANCELLED",r=null,i=null,await R.prisma.flightInstance.update({where:{id:e.id},data:{status:t,actualDeparture:r,actualArrival:i}});continue}let n=["RAINY","SNOWY","FOGGY"].includes(e.weatherOrigin||"")?.4:.1;if(["SCHEDULED","DELAYED"].includes(t)&&Math.random()<n&&"DELAYED"!==t){t="DELAYED";let e=Math.floor(90*Math.random())+30;r&&(r=new Date(r.getTime()+6e4*e)),i&&(i=new Date(i.getTime()+6e4*e))}if("CANCELLED"!==t&&r&&i&&r.getTime()===e.scheduledDeparture.getTime()&&i.getTime()===e.scheduledArrival.getTime()){let t=Math.floor(31*Math.random())-10;r=new Date(e.scheduledDeparture.getTime()+6e4*t);let a=Math.floor(31*Math.random())-20,n=e.scheduledArrival.getTime()-e.scheduledDeparture.getTime();i=new Date(r.getTime()+n+6e4*a)}if("CANCELLED"!==t){let n=r?r.getTime():e.scheduledDeparture.getTime(),l=i?i.getTime():e.scheduledArrival.getTime();a.getTime()>=l?t="ARRIVED":a.getTime()>=n?t="IN_AIR":a.getTime()>=n-12e5?("SCHEDULED"===t||"DELAYED"===t||"PREPARING"===t||"BOARDING"===t)&&(t="GATE_CLOSED"):a.getTime()>=n-3e6?("SCHEDULED"===t||"DELAYED"===t||"PREPARING"===t)&&(t="BOARDING"):a.getTime()>=n-72e5&&("SCHEDULED"===t||"DELAYED"===t)&&(t="PREPARING")}(t!==e.status||r?.getTime()!==e.actualDeparture?.getTime()||i?.getTime()!==e.actualArrival?.getTime())&&await R.prisma.flightInstance.update({where:{id:e.id},data:{status:t,actualDeparture:r,actualArrival:i}})}console.log("âœ… ç‹€æ…‹æ›´æ–°å®Œæˆ")}let C=0,y=null,S=null;async function M(e){let t,a,r,i=(t=e.getFullYear(),a=String(e.getMonth()+1).padStart(2,"0"),r=String(e.getDate()).padStart(2,"0"),`${t}-${a}-${r}`);if(i!==S&&(S=i,C=0,y=null),!(Date.now()-C<6e4))return y||(y=(async()=>{try{await E(e),await N(e)}finally{C=Date.now(),y=null}})())}async function I(e){try{let{searchParams:t}=new URL(e.url),a=t.get("date"),r="1"===t.get("full"),i=t.get("limit"),n=t.get("offset"),l=t.get("status"),o=t.get("search"),s=a?new Date(a):new Date;s.setHours(0,0,0,0);let u=new Date;u.setHours(0,0,0,0),s.getTime()===u.getTime()?await M(s):s>u&&await E(s);let d=i?Math.max(1,Math.min(parseInt(i,10)||25,200)):null,c=n?Math.max(0,parseInt(n,10)||0):0,h=(o||"").trim(),g=l&&"ALL"!==l?l:null,p={date:s};g&&(p.status=g),h&&(p.flight={OR:[{flightNumber:{contains:h}},{from:{contains:h}},{to:{contains:h}},{fromCity:{contains:h}},{toCity:{contains:h}}]});let f=await R.prisma.flightInstance.findMany({where:p,select:r?{id:!0,date:!0,status:!0,scheduledDeparture:!0,scheduledArrival:!0,actualDeparture:!0,actualArrival:!0,aircraftType:!0,aircraftRegistration:!0,gate:!0,terminal:!0,weatherOrigin:!0,weatherDestination:!0,flight:{select:{flightNumber:!0,airline:!0,from:!0,to:!0,fromCity:!0,toCity:!0,duration:!0}}}:{id:!0,date:!0,status:!0,scheduledDeparture:!0,scheduledArrival:!0,actualDeparture:!0,actualArrival:!0,aircraftRegistration:!0,flight:{select:{flightNumber:!0,airline:!0,from:!0,to:!0,fromCity:!0,toCity:!0,duration:!0}}},orderBy:{scheduledDeparture:"asc"},...d?{skip:c,take:d?d+1:void 0}:{}});if(!d)return A.NextResponse.json(f);let m=f.length>d,D=m?f.slice(0,d):f,w=m?c+d:null;return A.NextResponse.json({items:D,hasMore:m,nextOffset:w})}catch(e){return console.error("ç²å–èˆªç­ç‹€æ…‹å¤±æ•—:",e),A.NextResponse.json({error:"ç²å–èˆªç­ç‹€æ…‹å¤±æ•—"},{status:500})}}e.s(["GET",()=>I],25095);var O=e.i(25095);let b=new t.AppRouteRouteModule({definition:{kind:a.RouteKind.APP_ROUTE,page:"/api/flight-status/route",pathname:"/api/flight-status",filename:"route",bundlePath:""},distDir:".next",relativeProjectDir:"",resolvedPagePath:"[project]/Documents/Yellow Airlines/yellow-airlines/backend/app/api/flight-status/route.ts",nextConfigOutput:"",userland:O}),{workAsyncStorage:x,workUnitAsyncStorage:L,serverHooks:H}=b;function P(){return(0,r.patchFetch)({workAsyncStorage:x,workUnitAsyncStorage:L})}async function U(e,t,r){b.isDev&&(0,i.addRequestMeta)(e,"devRequestTimingInternalsEnd",process.hrtime.bigint());let A="/api/flight-status/route";A=A.replace(/\/index$/,"")||"/";let R=await b.prepare(e,t,{srcPage:A,multiZoneDraftMode:!1});if(!R)return t.statusCode=400,t.end("Bad Request"),null==r.waitUntil||r.waitUntil.call(r,Promise.resolve()),null;let{buildId:T,params:v,nextConfig:E,parsedUrl:N,isDraftMode:C,prerenderManifest:y,routerServerContext:S,isOnDemandRevalidate:M,revalidateOnlyGenerated:I,resolvedPathname:O,clientReferenceManifest:x,serverActionsManifest:L}=R,H=(0,s.normalizeAppPath)(A),P=!!(y.dynamicRoutes[H]||y.routes[O]),U=async()=>((null==S?void 0:S.render404)?await S.render404(e,t,N,!1):t.end("This page could not be found"),null);if(P&&!C){let e=!!y.routes[O],t=y.dynamicRoutes[H];if(t&&!1===t.fallback&&!e){if(E.experimental.adapterPath)return await U();throw new D.NoFallbackError}}let $=null;!P||b.isDev||C||($="/index"===($=O)?"/":$);let _=!0===b.isDev||!P,Y=P&&!_;L&&x&&(0,l.setReferenceManifestsSingleton)({page:A,clientReferenceManifest:x,serverActionsManifest:L,serverModuleMap:(0,o.createServerModuleMap)({serverActionsManifest:L})});let k=e.method||"GET",G=(0,n.getTracer)(),q=G.getActiveScopeSpan(),B={params:v,prerenderManifest:y,renderOpts:{experimental:{authInterrupts:!!E.experimental.authInterrupts},cacheComponents:!!E.cacheComponents,supportsDynamicResponse:_,incrementalCache:(0,i.getRequestMeta)(e,"incrementalCache"),cacheLifeProfiles:E.cacheLife,waitUntil:r.waitUntil,onClose:e=>{t.on("close",e)},onAfterTaskError:void 0,onInstrumentationRequestError:(t,a,r)=>b.onRequestError(e,t,r,S)},sharedContext:{buildId:T}},F=new u.NodeNextRequest(e),j=new u.NodeNextResponse(t),K=d.NextRequestAdapter.fromNodeNextRequest(F,(0,d.signalFromNodeResponse)(t));try{let l=async e=>b.handle(K,B).finally(()=>{if(!e)return;e.setAttributes({"http.status_code":t.statusCode,"next.rsc":!1});let a=G.getRootSpanAttributes();if(!a)return;if(a.get("next.span_type")!==c.BaseServerSpan.handleRequest)return void console.warn(`Unexpected root span type '${a.get("next.span_type")}'. Please report this Next.js issue https://github.com/vercel/next.js`);let r=a.get("next.route");if(r){let t=`${k} ${r}`;e.setAttributes({"next.route":r,"http.route":r,"next.span_name":t}),e.updateName(t)}else e.updateName(`${k} ${A}`)}),o=!!(0,i.getRequestMeta)(e,"minimalMode"),s=async i=>{var n,s;let u=async({previousCacheEntry:a})=>{try{if(!o&&M&&I&&!a)return t.statusCode=404,t.setHeader("x-nextjs-cache","REVALIDATED"),t.end("This page could not be found"),null;let n=await l(i);e.fetchMetrics=B.renderOpts.fetchMetrics;let s=B.renderOpts.pendingWaitUntil;s&&r.waitUntil&&(r.waitUntil(s),s=void 0);let u=B.renderOpts.collectedTags;if(!P)return await (0,g.sendResponse)(F,j,n,B.renderOpts.pendingWaitUntil),null;{let e=await n.blob(),t=(0,p.toNodeOutgoingHttpHeaders)(n.headers);u&&(t[m.NEXT_CACHE_TAGS_HEADER]=u),!t["content-type"]&&e.type&&(t["content-type"]=e.type);let a=void 0!==B.renderOpts.collectedRevalidate&&!(B.renderOpts.collectedRevalidate>=m.INFINITE_CACHE)&&B.renderOpts.collectedRevalidate,r=void 0===B.renderOpts.collectedExpire||B.renderOpts.collectedExpire>=m.INFINITE_CACHE?void 0:B.renderOpts.collectedExpire;return{value:{kind:w.CachedRouteKind.APP_ROUTE,status:n.status,body:Buffer.from(await e.arrayBuffer()),headers:t},cacheControl:{revalidate:a,expire:r}}}}catch(t){throw(null==a?void 0:a.isStale)&&await b.onRequestError(e,t,{routerKind:"App Router",routePath:A,routeType:"route",revalidateReason:(0,h.getRevalidateReason)({isStaticGeneration:Y,isOnDemandRevalidate:M})},S),t}},d=await b.handleResponse({req:e,nextConfig:E,cacheKey:$,routeKind:a.RouteKind.APP_ROUTE,isFallback:!1,prerenderManifest:y,isRoutePPREnabled:!1,isOnDemandRevalidate:M,revalidateOnlyGenerated:I,responseGenerator:u,waitUntil:r.waitUntil,isMinimalMode:o});if(!P)return null;if((null==d||null==(n=d.value)?void 0:n.kind)!==w.CachedRouteKind.APP_ROUTE)throw Object.defineProperty(Error(`Invariant: app-route received invalid cache entry ${null==d||null==(s=d.value)?void 0:s.kind}`),"__NEXT_ERROR_CODE",{value:"E701",enumerable:!1,configurable:!0});o||t.setHeader("x-nextjs-cache",M?"REVALIDATED":d.isMiss?"MISS":d.isStale?"STALE":"HIT"),C&&t.setHeader("Cache-Control","private, no-cache, no-store, max-age=0, must-revalidate");let c=(0,p.fromNodeOutgoingHttpHeaders)(d.value.headers);return o&&P||c.delete(m.NEXT_CACHE_TAGS_HEADER),!d.cacheControl||t.getHeader("Cache-Control")||c.get("Cache-Control")||c.set("Cache-Control",(0,f.getCacheControlHeader)(d.cacheControl)),await (0,g.sendResponse)(F,j,new Response(d.value.body,{headers:c,status:d.value.status||200})),null};q?await s(q):await G.withPropagatedContext(e.headers,()=>G.trace(c.BaseServerSpan.handleRequest,{spanName:`${k} ${A}`,kind:n.SpanKind.SERVER,attributes:{"http.method":k,"http.target":e.url}},s))}catch(t){if(t instanceof D.NoFallbackError||await b.onRequestError(e,t,{routerKind:"App Router",routePath:H,routeType:"route",revalidateReason:(0,h.getRevalidateReason)({isStaticGeneration:Y,isOnDemandRevalidate:M})}),P)throw t;return await (0,g.sendResponse)(F,j,new Response(null,{status:500})),null}}e.s(["handler",()=>U,"patchFetch",()=>P,"routeModule",()=>b,"serverHooks",()=>H,"workAsyncStorage",()=>x,"workUnitAsyncStorage",()=>L],93050)}];

//# sourceMappingURL=63c6c_next_dist_esm_build_templates_app-route_8a7a1c62.js.map